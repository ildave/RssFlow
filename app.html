<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <style>
        .item {
            width: 500px;
            border: 1px solid black;
            padding: 15px;
            margin: auto;
            margin-top: 10px;
            display: none;
            opacity: 0;
            transition: .8s;
            border-radius: 20px;
        }
        .show {
            transition: opacity 5000ms;
        }
        .hide {
            opacity: 0;
        }
        </style>
    </head>
    <body>
        <script>
            var itemsQueue = [];
            var ws = new WebSocket("ws://127.0.0.1:8066/");
            ws.onmessage = function (event) {
                console.log(event);
                var cnt = JSON.parse(event.data);
                itemsQueue.push(cnt);
            };
            
            function showItem() {
                if (itemsQueue.length > 0) {
                    var cnt = itemsQueue.shift();
                    var items = document.querySelectorAll('div.item');
                    if (items.length > 25) {
                        var last = items[items.length - 1];
                        last.parentElement.removeChild(last);
                    }
                    var div = makeItem(cnt.link, cnt.description, cnt.feedtitle, cnt.title, cnt.updated);
                    if (items.length == 0) {
                        document.body.appendChild(div);
                    }
                    else {
                        var first = items[0];
                        document.body.insertBefore(div, first);
                    }
                    div.style.display = "block";
                    requestAnimationFrame(() => div.style.opacity = 1);
                }
            }

            function makeItem(url, description, feedtitle, title, updated) {
                var div = document.createElement('div');
                div.classList.add('item');
                var h1 = document.createElement('h1');
                var a = document.createElement('a');
                var em = document.createElement('em');
                var p = document.createElement('p');
                p.appendChild(document.createTextNode(description));
                em.appendChild(document.createTextNode(timeConverter(updated)));
                h1.appendChild(document.createTextNode(feedtitle + ' - ' + title));
                a.setAttribute('href', url);
                a.appendChild(h1);
                div.appendChild(a);
                div.appendChild(p);
                div.appendChild(em);
                return div;
            }

            function timeConverter(UNIX_timestamp){
                var a = new Date(UNIX_timestamp * 1000);
                var months = ['Gen','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                var year = a.getFullYear();
                var month = months[a.getMonth()];
                var date = addZero(a.getDate());
                var hour = addZero(a.getHours());
                var min = addZero(a.getMinutes());
                var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min;
                return time;
                }
            
            function addZero(n) {
                var out = n;
                if (n <= 9) {
                    out = '0' + n;
                }
                return out;
            }

            window.setInterval(showItem, 3000);
        </script>
    </body>
</html>